# ==============================================
# GitHub Actions ìë™ ë°°í¬ ì›Œí¬í”Œë¡œìš°
#
# ë™ì‘ íë¦„:
# 1. main ë¸Œëœì¹˜ì— push ë°œìƒ
# 2. GitHub Actionsê°€ ìë™ìœ¼ë¡œ ì´ ì›Œí¬í”Œë¡œìš° ì‹¤í–‰
# 3. SSHë¡œ Lightsail ì¸ìŠ¤í„´ìŠ¤ì— ì ‘ì†
# 4. ë°°í¬ ìŠ¤í¬ë¦½íŠ¸(scripts/deploy.sh) ì‹¤í–‰
#
# í•„ìš”í•œ GitHub Secrets (ì €ì¥ì†Œ Settings â†’ Secretsì—ì„œ ì„¤ì •):
#   LIGHTSAIL_HOST     â€” Lightsail ì¸ìŠ¤í„´ìŠ¤ ê³µì¸ IP ì£¼ì†Œ
#   LIGHTSAIL_USERNAME â€” SSH ì‚¬ìš©ìëª… (ë³´í†µ ubuntu)
#   LIGHTSAIL_SSH_KEY  â€” SSH í”„ë¼ì´ë¹— í‚¤ (ì „ì²´ ë‚´ìš©)
# ==============================================

name: Deploy to AWS Lightsail

# main ë¸Œëœì¹˜ì— push ë  ë•Œë§Œ ì‹¤í–‰
on:
  push:
    branches:
      - main

jobs:
  deploy:
    name: ğŸš€ Lightsail ë°°í¬
    runs-on: ubuntu-latest

    steps:
      # 1ë‹¨ê³„: ì½”ë“œ ì²´í¬ì•„ì›ƒ (ì›Œí¬í”Œë¡œìš°ì—ì„œ ì½”ë“œë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´)
      - name: ğŸ“¥ ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4

      # 2ë‹¨ê³„: SSHë¡œ Lightsailì— ì ‘ì†í•˜ì—¬ ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
      - name: ğŸ”‘ SSHë¡œ ë°°í¬ ì‹¤í–‰
        uses: appleboy/ssh-action@v1
        with:
          host: ${{ secrets.LIGHTSAIL_HOST }}
          username: ${{ secrets.LIGHTSAIL_USERNAME }}
          key: ${{ secrets.LIGHTSAIL_SSH_KEY }}
          script: |
            bash /home/ubuntu/react-todo/scripts/deploy.sh
